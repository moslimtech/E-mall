-->
<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ø§Ù„Ù…ÙƒØ§Ù†</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<!-- ØªØ¶Ù…ÙŠÙ† Tailwind CSS Ù„ØªØµÙ…ÙŠÙ… Ø³Ø±ÙŠØ¹ ÙˆØ¬Ù…ÙŠÙ„ -->
<script src="https://cdn.tailwindcss.com"></script>
<style>
  body { font-family: 'Cairo', sans-serif; background:#f9f9f9; margin:0; padding:15px; }
  h1 { text-align:center; margin-bottom:15px; color: #333; }
  .ads-grid { display:grid; grid-template-columns:repeat(auto-fill, minmax(200px, 1fr)); gap:12px; }
  .ad-card { background:#fff; border-radius:10px; padding:10px; box-shadow:0 2px 6px rgba(0,0,0,.1); text-align:center; transition: transform 0.2s ease-in-out; }
  .ad-card:hover { transform: translateY(-5px); }
  .ad-card img { width:100%; height:120px; object-fit:cover; border-radius:6px; margin-bottom:6px; }
  .ad-card h3 { font-size:14px; margin:5px 0; color: #333; }
  .ad-card p { font-size:12px; color:#555; margin:2px 0; }
  .ad-card a { color: #2196f3; text-decoration: none; font-weight: bold; transition: color 0.2s ease-in-out; }
  .ad-card a:hover { color: #1976d2; }
  .btn-back { background:#2196f3; color:white; padding:8px 12px; border:none; border-radius:5px; cursor:pointer; display:block; margin:10px auto; transition: background-color 0.2s ease-in-out; }
  .btn-back:hover { background:#1976d2; }

  /* Ù…Ø¤Ø´Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„ */
  .loading-spinner {
      border: 4px solid rgba(0, 0, 0, 0.1);
      border-left-color: #2196f3; /* Ù„ÙˆÙ† Ø£Ø²Ø±Ù‚ Ø¬Ø°Ø§Ø¨ */
      border-radius: 50%;
      width: 30px;
      height: 30px;
      animation: spin 1s linear infinite;
      margin: 20px auto;
  }
  @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
  }
  .status-message {
      text-align: center;
      padding: 10px;
      color: #555;
  }
</style>
</head>
<body>
<h1>Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ø§Ù„Ù…ÙƒØ§Ù†</h1>
<button class="btn-back" onclick="window.history.back()">Ø±Ø¬ÙˆØ¹</button>
<div class="status-message" id="globalStatusMessage">
    <div class="loading-spinner"></div>
    <p>Ø¬Ø§Ø±Ù ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª...</p>
</div>
<div id="adsGrid" class="ads-grid"></div>

<script>
// ğŸš¨ Ù‡Ø§Ù…: Ù‡Ø°Ø§ Ù‡Ùˆ Ø±Ø§Ø¨Ø· Ø§Ù„Ù€ Web App Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ Ø§Ù„Ø°ÙŠ Ø­ØµÙ„Øª Ø¹Ù„ÙŠÙ‡ Ù…Ù† Google Apps Script
const API_URL = "https://script.google.com/macros/s/AKfycbxkKrHyeEAgSkLz2QHzSgA5w09dIvfFJgDUMkP373f-VVAZmahHalr0GOYojqK41x6E/exec"; 

// ÙØªØ±Ø© Ø§Ù„Ø§Ø³ØªØ¹Ù„Ø§Ù… Ø¨Ø§Ù„Ù…Ù„Ù„ÙŠ Ø«Ø§Ù†ÙŠØ© (Ù…Ø«Ø§Ù„: ÙƒÙ„ 10 Ø«ÙˆØ§Ù†Ù)
const POLLING_INTERVAL_MS = 10000; // 10 Ø«ÙˆØ§Ù†Ù

const urlParams = new URLSearchParams(window.location.search);
const placeId = urlParams.get('place');

const adsGrid = document.getElementById("adsGrid");
const globalStatusMessage = document.getElementById('globalStatusMessage');

let currentAdsForPlace = []; // Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ© Ù„Ù‡Ø°Ø§ Ø§Ù„Ù…ÙƒØ§Ù†

/**
 * ÙŠØ¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Google Apps Script Web App API.
 * @returns {Promise<Object|null>} ÙƒØ§Ø¦Ù† ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ù…Ø§ÙƒÙ† ÙˆØ§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§ØªØŒ Ø£Ùˆ null ÙÙŠ Ø­Ø§Ù„Ø© Ø§Ù„Ø®Ø·Ø£.
 */
async function fetchData() {
    globalStatusMessage.innerHTML = '<div class="loading-spinner"></div><p>Ø¬Ø§Ø±Ù ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª...</p>';
    globalStatusMessage.style.display = 'block'; // Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„

    try {
        const response = await fetch(API_URL);
        const data = await response.json();

        if (response.ok && !data.error) {
            globalStatusMessage.style.display = 'none'; // Ø¥Ø®ÙØ§Ø¡ Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø¹Ù†Ø¯ Ø§Ù„Ù†Ø¬Ø§Ø­
            return data;
        } else {
            console.error('Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† API:', data.error || response.statusText);
            globalStatusMessage.innerHTML = `<p class="text-red-500">Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: ${data.error || response.statusText}</p>`;
            return null;
        }
    } catch (error) {
        console.error('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:', error);
        globalStatusMessage.innerHTML = `<p class="text-red-500">Ø­Ø¯Ø« Ø®Ø·Ø£ ØºÙŠØ± Ù…ØªÙˆÙ‚Ø¹: ${error.message}</p>`;
        return null;
    }
}

/**
 * ÙŠÙ‚ÙˆÙ… Ø¨Ø¹Ø±Ø¶ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ø§Ù„Ø®Ø§ØµØ© Ø¨Ø§Ù„Ù…ÙƒØ§Ù† Ø§Ù„Ù…Ø­Ø¯Ø¯.
 * @param {Array<Object>} ads - Ù…ØµÙÙˆÙØ© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª.
 */
function renderAds(ads) {
  adsGrid.innerHTML = ""; // Ù…Ø³Ø­ Ø§Ù„Ø´Ø¨ÙƒØ© Ø§Ù„Ø­Ø§Ù„ÙŠØ©

  const filteredAds = ads.filter(ad => 
    ad["Ù…Ø¹Ø±Ù Ø§Ù„Ù…ÙƒØ§Ù†"] === placeId && ad["Ø­Ø§Ù„Ø© Ø§Ù„Ø§Ø¹Ù„Ø§Ù†"] === "Ù†Ø´Ø·"
  );

  if (filteredAds.length === 0) {
    adsGrid.innerHTML = "<p class='text-center text-gray-500 py-4 col-span-full'>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ù†Ø´Ø·Ø© Ù„Ù‡Ø°Ø§ Ø§Ù„Ù…ÙƒØ§Ù†.</p>";
    return;
  }

  filteredAds.forEach(ad => {
    const card = document.createElement("div");
    card.className = "ad-card";

    card.innerHTML = `
      <img src="${ad["Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø©"] || 'https://placehold.co/150x120/cccccc/333333?text=Ù„Ø§ ØªÙˆØ¬Ø¯ ØµÙˆØ±Ø©'}" 
           alt="Ø¥Ø¹Ù„Ø§Ù†"
           onerror="this.onerror=null;this.src='https://placehold.co/150x120/cccccc/333333?text=Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØµÙˆØ±Ø©';">
      <h3>${ad["Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¹Ø±Ø¶"] || "Ø¹Ø±Ø¶ Ø¨Ø¯ÙˆÙ† Ø¹Ù†ÙˆØ§Ù†"}</h3>
      <p>${ad["ÙˆØµÙ"] || ""}</p>
      ${ad["Ø±Ø§Ø¨Ø· Ø§Ù„ÙÙŠØ¯ÙŠÙˆ"] ? `<p><a href="${ad["Ø±Ø§Ø¨Ø· Ø§Ù„ÙÙŠØ¯ÙŠÙˆ"]}" target="_blank">Ù…Ø´Ø§Ù‡Ø¯Ø© Ø§Ù„ÙÙŠØ¯ÙŠÙˆ</a></p>` : ""}
      <p>Ù…Ù† ${ad["ØªØ§Ø±ÙŠØ® Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ø§Ø¹Ù„Ø§Ù†"] || "-"} Ø¥Ù„Ù‰ ${ad["ØªØ§Ø±ÙŠØ® Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø§Ø¹Ù„Ø§Ù†"] || "-"}</p>
    `;
    adsGrid.appendChild(card);
  });
}

/**
 * ÙˆØ¸ÙŠÙØ© Ø§Ù„ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø£ÙˆÙ„ÙŠØ© ÙˆØ¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯ÙˆØ±ÙŠØ©.
 */
async function init() {
    const newData = await fetchData();
    if (newData && newData.ads) {
        const filteredAds = newData.ads.filter(ad => 
            ad["Ù…Ø¹Ø±Ù Ø§Ù„Ù…ÙƒØ§Ù†"] === placeId && ad["Ø­Ø§Ù„Ø© Ø§Ù„Ø§Ø¹Ù„Ø§Ù†"] === "Ù†Ø´Ø·"
        );

        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù…Ø§ Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ù„Ù‡Ø°Ø§ Ø§Ù„Ù…ÙƒØ§Ù† Ù‚Ø¯ ØªØºÙŠØ±Øª Ù‚Ø¨Ù„ Ø§Ù„ØªØ­Ø¯ÙŠØ«
        if (JSON.stringify(filteredAds) !== JSON.stringify(currentAdsForPlace)) {
            currentAdsForPlace = filteredAds;
            renderAds(currentAdsForPlace);
            console.log("Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ø§Ù„Ù…ÙƒØ§Ù† ØªÙ… ØªØ­Ø¯ÙŠØ«Ù‡Ø§ ÙˆØ¹Ø±Ø¶Ù‡Ø§ Ø¨Ù†Ø¬Ø§Ø­.");
        } else {
            console.log("Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ø§Ù„Ù…ÙƒØ§Ù† Ù„Ù… ØªØªØºÙŠØ±. Ù„Ø§ Ø­Ø§Ø¬Ø© Ù„Ù„ØªØ­Ø¯ÙŠØ«.");
        }
    }
}

// ØªØ´ØºÙŠÙ„ Ø§Ù„ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø£ÙˆÙ„ÙŠØ© Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
document.addEventListener('DOMContentLoaded', () => {
    if (!placeId) {
        adsGrid.innerHTML = '<p class="text-center text-red-500 py-4 col-span-full">Ø®Ø·Ø£: Ù„Ù… ÙŠØªÙ… ØªØ­Ø¯ÙŠØ¯ Ù…Ø¹Ø±Ù Ø§Ù„Ù…ÙƒØ§Ù†.</p>';
        globalStatusMessage.style.display = 'none';
        return;
    }
    init(); // Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ø£ÙˆÙ„ Ù…Ø±Ø©
    // Ø¨Ø¯Ø¡ Ø§Ù„Ø§Ø³ØªØ¹Ù„Ø§Ù… Ø§Ù„Ù…ØªÙƒØ±Ø± Ø¨Ø¹Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£ÙˆÙ„ÙŠ
    setInterval(init, POLLING_INTERVAL_MS);
});
</script>
</body>
</html>
<!--
