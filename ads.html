<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>إعلانات المكان</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <header>
    <h1>إعلانات المكان</h1>
    <button onclick="history.back()" style="margin:10px; padding:8px; background:#2196f3; color:#fff; border:none; border-radius:6px;">رجوع</button>
  </header>

  <main>
    <div id="adsGrid" class="grid"></div>
    <p id="noAdsMsg" style="text-align:center; margin-top:20px; color:#777; font-size:16px;">جار التحميل...</p>
  </main>

  <footer>
    <p>© 2025 المول الإلكتروني</p>
  </footer>

  <script>
    const API_URL = "ضع_هنا_رابط_الويب_آب"; // رابط Web App من Google Apps Script
    const adsGrid = document.getElementById("adsGrid");
    const noAdsMsg = document.getElementById("noAdsMsg");
    const urlParams = new URLSearchParams(window.location.search);
    const placeId = urlParams.get("place");

    async function fetchAds() {
      try {
        const response = await fetch(API_URL);
        const data = await response.json();

        const allAds = data.ads || [];
        const adsForPlace = allAds.filter(ad => ad["معرف المكان"] === placeId && ad["حالة الاعلان"] === "نشط");

        adsGrid.innerHTML = "";
        if (adsForPlace.length === 0) {
          noAdsMsg.textContent = "لا توجد إعلانات نشطة لهذا المكان.";
          return;
        }

        noAdsMsg.style.display = "none";
        adsForPlace.forEach(ad => {
          const card = document.createElement("div");
          card.className = "card";
          card.innerHTML = `
            <img src="${ad["رابط الصورة"] || 'placeholder.jpg'}" alt="صورة الإعلان">
            <h3>${ad["عنوان العرض"] || "بدون عنوان"}</h3>
            <p>${ad["وصف"] || ""}</p>
            ${ad["رابط يوتيوب"] ? `<a href="${ad["رابط يوتيوب"]}" target="_blank" style="color:red;">مشاهدة الفيديو</a>` : ""}
          `;
          adsGrid.appendChild(card);
        });
      } catch (error) {
        console.error("خطأ في جلب البيانات:", error);
        noAdsMsg.textContent = "حدث خطأ أثناء تحميل الإعلانات.";
      }
    }

    fetchAds();
    setInterval(fetchAds, 30000); // تحديث كل 30 ثانية
  </script>
</body>
</html>

