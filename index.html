<!DOCTYPE html>
<html dir="rtl" lang="ar">
<head>
  <meta charset="UTF-8">
  <title>Ù…Ù†ØµØ© E-Mall ğŸ›ï¸</title>
  <style>
    body { font-family: 'Cairo', sans-serif; background-color: #f9fafb; margin: 0; padding: 0; }
    header { background: #3b82f6; color: white; padding: 1rem; text-align: center; font-size: 1.4rem; }
    select { margin: 1rem; padding: 0.5rem; font-size: 1rem; }
    .container { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 1rem; padding: 1rem; }
    .card { background: white; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); overflow: hidden; }
    .card img { width: 100%; height: 180px; object-fit: cover; }
    .card-content { padding: 1rem; }
    .card-content .title { font-size: 1.1rem; font-weight: bold; color: #1f2937; }
    .card-content .desc { font-size: 0.95rem; color: #4b5563; margin-top: 0.5rem; }
  </style>
</head>
<body>
  <header>Ù…Ù†ØµØ© E-Mall ğŸ›ï¸</header>
  <div style="text-align:center;">
    <label>ÙÙ„ØªØ± Ø­Ø³Ø¨ Ø§Ù„Ù†Ø´Ø§Ø·:</label>
    <select id="filter"><option value="">Ø§Ù„ÙƒÙ„</option></select>
  </div>
  <div class="container" id="ads-container">Ø¬Ø§Ø±Ù Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>

  <script>
    const SHEET_TSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSYXS6ck5TQ0s_GDMFXoBk8jtyk0yqm4WG8BifY9rJoT6jONy5yFhhkc4u5QyrcjQxPVSFZ4H2PodFS/pub?gid=2059461251&single=true&output=tsv";
    const APPSHEET_APP_NAME = "E-mall-800546514";

    async function fetchAds() {
      const res = await fetch(SHEET_TSV_URL);
      const text = await res.text();
      const rows = text.trim().split('\n').map(r => r.split('\t'));
      const headers = rows[0];
      return rows.slice(1).map(row =>
        Object.fromEntries(row.map((v, i) => [headers[i], v]))
      );
    }

    function extractAppSheetImage(fileName) {
      return fileName && fileName.includes("Images/")
        ? `https://www.appsheet.com/template/gettablefileurl?appName=${APPSHEET_APP_NAME}&tableName=Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª&fileName=${encodeURIComponent(fileName)}`
        : null;
    }

    function buildCard(ad) {
      const card = document.createElement("div");
      card.className = "card";

      const images = [ad["ØµÙˆØ±Ø©"]];
      for (let i = 2; i <= 8; i++) {
        const key = `ØµÙˆØ±Ø©${i}`;
        if (ad[key]) images.push(ad[key]);
      }

      const imageHtml = images.map(file => {
        const url = extractAppSheetImage(file);
        return url ? `<img src="${url}" alt="ØµÙˆØ±Ø©">` : "";
      }).join("");

      card.innerHTML = `
        ${imageHtml}
        <div class="card-content">
          <div class="title">${ad["Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¹Ø±Ø¶"] || "Ø¨Ø¯ÙˆÙ† Ø¹Ù†ÙˆØ§Ù†"}</div>
          <div class="desc">${ad["ÙˆØµÙ"] || "Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙˆØµÙ"}</div>
        </div>
      `;
      return card;
    }

    async function renderAds() {
      const ads = await fetchAds();
      const container = document.getElementById("ads-container");
      const select = document.getElementById("filter");

      const kinds = new Set();
      ads.forEach(ad => ad["Ù†ÙˆØ¹ Ø§Ù„Ù†Ø´Ø§Ø·"] && kinds.add(ad["Ù†ÙˆØ¹ Ø§Ù„Ù†Ø´Ø§Ø·"]));
      kinds.forEach(kind => {
        const opt = document.createElement("option");
        opt.value = kind;
        opt.textContent = kind;
        select.appendChild(opt);
      });

      function showFiltered(kind) {
        container.innerHTML = "";
        ads.filter(ad => !kind || ad["Ù†ÙˆØ¹ Ø§Ù„Ù†Ø´Ø§Ø·"] === kind)
            .forEach(ad => container.appendChild(buildCard(ad)));
      }

      select.addEventListener("change", () => showFiltered(select.value));
      showFiltered("");
    }

    renderAds();
  </script>
</body>
</html>
