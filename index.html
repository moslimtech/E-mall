<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8" />
  <title>معرض الإعلانات</title>
  <style>
    body      { direction:rtl;font-family:Calibri,Arial;background:#f6f6f6;margin:0;padding:20px }
    h1        { text-align:center;color:#333;margin-bottom:25px }
    .card     { background:#fff;border-radius:12px;box-shadow:0 2px 6px rgba(0,0,0,.12);
                margin:20px auto;max-width:900px;padding:18px }
    .title    { font-weight:bold;font-size:1.2rem;margin-bottom:6px;color:#0a3e68 }
    .desc     { margin:6px 0 14px;color:#555 }
    .mediaBox { display:flex;flex-wrap:wrap;gap:12px;justify-content:center }
    iframe    { width:360px;height:202px;border:none;border-radius:8px;box-shadow:0 1px 4px rgba(0,0,0,.1) }
    img       { width:180px;border-radius:8px;box-shadow:0 1px 4px rgba(0,0,0,.1) }
  </style>
</head>
<body>

<h1>معرض الإعلانات</h1>
<div id="ads"></div>

<script>
/* ‑‑‑‑‑‑ CONFIG ‑‑‑‑‑‑ */
const SHEET   = 'الاعلانات';                // اسم الورقة
const SHEETID = '1Xni75nPl7IJRyCN4_DJ1MAmB11ZPT1X0oxsZmCMlxgs';             // ضع معرِّف Google Sheet هنا
/* ‑‑‑‑‑‑ /CONFIG ‑‑‑‑‑‑ */

const url = `https://docs.google.com/spreadsheets/d/${SHEETID}/gviz/tq?tqx=out:json&sheet=${encodeURIComponent(SHEET)}`;

fetch(url)
  .then(r => r.text())
  .then(raw => JSON.parse(raw.slice(47,-2)))
  .then(data => {
      const rows = data.table.rows;
      const head = data.table.cols.map(c => c.label.trim());
      const elAds = document.getElementById('ads');

      rows.forEach(r => {
        const obj = {};
        head.forEach((h,i)=> obj[h] = r.c[i]?.v || '');

        const hasMedia = obj['فيديو'] || obj['صورة'] || obj['صورة2'] || obj['شعار المكان'];
        if (!hasMedia) return;            // تجاهل الصفوف الخالية تمامًا

        const card  = document.createElement('div');
        card.className = 'card';

        /* العنوان والوصف */
        if (obj['عنوان العرض']) {
          const t = document.createElement('div');
          t.className='title'; t.textContent = obj['عنوان العرض'];
          card.appendChild(t);
        }
        if (obj['وصف']) {
          const d = document.createElement('div');
          d.className='desc'; d.textContent = obj['وصف'];
          card.appendChild(d);
        }

        /* الوسائط */
        const box = document.createElement('div');
        box.className = 'mediaBox';

        // فيديو
        if (obj['رابط الفيديو']) {
          box.appendChild(makeIframe(obj['رابط الفيديو']));
        }

        // صور 1‑8
        for (let i=0;i<=8;i++){
          const imgCol  = i===0 ? 'رابط الصورة'   : `رابط صورة${i}`;
          const link = obj[imgCol];
          if (link) box.appendChild(makeImg(link));
        }

        // شعار المكان
        if (obj['رابط صورة شعار المكان']) {
          box.appendChild(makeImg(obj['رابط صورة شعار المكان']));
        }

        card.appendChild(box);
        elAds.appendChild(card);
      });
  })
  .catch(err => console.error('Sheet Load Error:',err));

/* helpers */
function makeIframe(src){
  const f=document.createElement('iframe');
  f.src = fixDriveLink(src); f.allowFullscreen=true; return f;
}
function makeImg(src){
  const im=document.createElement('img');
  im.src = fixDriveLink(src); return im;
}
function fixDriveLink(link){
  /* يحوّل أي رابط Google Drive إلى صيغة preview المناسبة */
  if (/\/file\/d\/.+\/preview/.test(link)) return link;
  const idMatch = link.match(/[-\w]{25,}/);
  return idMatch ? `https://drive.google.com/file/d/${idMatch[0]}/preview` : link;
}
</script>

</body>
</html>

