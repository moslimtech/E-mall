<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>مولد الفواتير وعروض الأسعار</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.2/html2pdf.bundle.min.js"></script>
  <style>
    body { font-family: "Tahoma", sans-serif; background:#f7f7f7; padding:20px; }
    h2 { text-align:center; }
    table { width:100%; border-collapse: collapse; margin-top:10px; background:#fff; }
    table, th, td { border:1px solid #ccc; }
    th, td { padding:8px; text-align:center; }
    .btn { padding:10px 20px; margin:10px; cursor:pointer; border:none; border-radius:5px; }
    .add { background:#4CAF50; color:#fff; }
    .pdf { background:#2196F3; color:#fff; }
    #invoice { background:#fff; padding:15px; border-radius:10px; }
  </style>
</head>
<body>

  <h2>🧾 مولد الفواتير وعروض الأسعار</h2>

  <label>اختر النوع: </label>
  <select id="docType">
    <option value="فاتورة">فاتورة</option>
    <option value="عرض أسعار">عرض أسعار</option>
  </select>

  <br><br>
  <label>اسم التاجر/المحل: </label>
  <input type="text" id="merchant" placeholder="مثال: شركة مسلم تك">

  <div id="invoice">
    <h3 id="invoiceTitle">فاتورة</h3>
    <p id="merchantName">التاجر: بدون اسم</p>

    <table id="itemsTable">
      <tr>
        <th>الصنف</th>
        <th>الكمية</th>
        <th>سعر الوحدة</th>
        <th>الإجمالي</th>
        <th>✖</th>
      </tr>
    </table>

    <h3>الإجمالي النهائي: <span id="total">0</span> ج.م</h3>
  </div>

  <button class="btn add" onclick="addRow()">➕ إضافة صنف</button>
  <button class="btn pdf" onclick="generatePDF()">📥 تحميل PDF</button>

  <script>
    function addRow() {
      let table = document.getElementById("itemsTable");
      let row = table.insertRow();
      row.innerHTML = `
        <td><input type="text" placeholder="اسم الصنف" oninput="updateInvoice()"></td>
        <td><input type="number" value="1" oninput="calcTotal()"></td>
        <td><input type="number" value="0" oninput="calcTotal()"></td>
        <td class="rowTotal">0</td>
        <td><button onclick="this.parentElement.parentElement.remove();calcTotal();">✖</button></td>
      `;
    }

    function calcTotal() {
      let table = document.getElementById("itemsTable");
      let rows = table.rows;
      let grandTotal = 0;
      for (let i = 1; i < rows.length; i++) {
        let qty = rows[i].cells[1].children[0].value || 0;
        let price = rows[i].cells[2].children[0].value || 0;
        let rowTotal = qty * price;
        rows[i].cells[3].innerText = rowTotal;
        grandTotal += rowTotal;
      }
      document.getElementById("total").innerText = grandTotal;
      updateInvoice();
    }

    function updateInvoice() {
      let type = document.getElementById("docType").value;
      let merchant = document.getElementById("merchant").value || "بدون اسم";
      document.getElementById("invoiceTitle").innerText = type;
      document.getElementById("merchantName").innerText = "التاجر: " + merchant;
    }

    function generatePDF() {
      const element = document.getElementById("invoice");
      html2pdf().set({
        margin: 10,
        filename: document.getElementById("docType").value + '.pdf',
        html2canvas: { scale: 2 },
        jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
      }).from(element).save();
    }
  </script>

</body>
</html>
