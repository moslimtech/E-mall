<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>مولد الفواتير وعروض الأسعار</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    body { font-family: "Tahoma", sans-serif; background:#f7f7f7; padding:20px; }
    h2 { text-align:center; }
    table { width:100%; border-collapse: collapse; margin-top:10px; background:#fff; }
    table, th, td { border:1px solid #ccc; }
    th, td { padding:8px; text-align:center; }
    .btn { padding:10px 20px; margin:10px; cursor:pointer; border:none; border-radius:5px; }
    .add { background:#4CAF50; color:#fff; }
    .pdf { background:#2196F3; color:#fff; }
  </style>
</head>
<body>

  <h2>🧾 مولد الفواتير وعروض الأسعار</h2>

  <label>اختر النوع: </label>
  <select id="docType">
    <option value="فاتورة">فاتورة</option>
    <option value="عرض أسعار">عرض أسعار</option>
  </select>

  <br><br>
  <label>اسم التاجر/المحل: </label>
  <input type="text" id="merchant" placeholder="مثال: شركة مسلم تك">
  <br><br>

  <table id="itemsTable">
    <tr>
      <th>الصنف</th>
      <th>الكمية</th>
      <th>سعر الوحدة</th>
      <th>الإجمالي</th>
      <th>✖</th>
    </tr>
  </table>

  <button class="btn add" onclick="addRow()">➕ إضافة صنف</button>

  <h3>الإجمالي النهائي: <span id="total">0</span> ج.م</h3>

  <button class="btn pdf" onclick="generatePDF()">📥 تحميل PDF</button>

  <script>
    function addRow() {
      let table = document.getElementById("itemsTable");
      let row = table.insertRow();
      row.innerHTML = `
        <td><input type="text" placeholder="اسم الصنف"></td>
        <td><input type="number" value="1" oninput="calcTotal()"></td>
        <td><input type="number" value="0" oninput="calcTotal()"></td>
        <td class="rowTotal">0</td>
        <td><button onclick="this.parentElement.parentElement.remove();calcTotal();">✖</button></td>
      `;
    }

    function calcTotal() {
      let table = document.getElementById("itemsTable");
      let rows = table.rows;
      let grandTotal = 0;
      for (let i = 1; i < rows.length; i++) {
        let qty = rows[i].cells[1].children[0].value;
        let price = rows[i].cells[2].children[0].value;
        let rowTotal = qty * price;
        rows[i].cells[3].innerText = rowTotal;
        grandTotal += rowTotal;
      }
      document.getElementById("total").innerText = grandTotal;
    }

    async function generatePDF() {
      const { jsPDF } = window.jspdf;
      let doc = new jsPDF();
      let type = document.getElementById("docType").value;
      let merchant = document.getElementById("merchant").value || "بدون اسم";

      doc.setFontSize(18);
      doc.text(type, 105, 20, { align: "center" });
      doc.setFontSize(12);
      doc.text("التاجر: " + merchant, 14, 30);

      let table = document.getElementById("itemsTable");
      let y = 40;

      doc.text("الصنف        الكمية        سعر الوحدة        الإجمالي", 14, y);
      y += 10;

      let rows = table.rows;
      for (let i = 1; i < rows.length; i++) {
        let item = rows[i].cells[0].children[0].value;
        let qty = rows[i].cells[1].children[0].value;
        let price = rows[i].cells[2].children[0].value;
        let total = rows[i].cells[3].innerText;
        doc.text(`${item}        ${qty}        ${price}        ${total}`, 14, y);
        y += 10;
      }

      y += 10;
      let grandTotal = document.getElementById("total").innerText;
      doc.text("الإجمالي النهائي: " + grandTotal + " ج.م", 14, y);

      doc.save(`${type}.pdf`);
    }
  </script>

</body>
</html>
